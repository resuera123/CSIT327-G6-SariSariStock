{% extends 'main/base.html' %}
{% load humanize %}
{% block title %}SariSariStock | Product Catalog{% endblock %}

{% block content %}
<style>
  html, body {
    height: 100%;
    margin: 0;
  }

  .layout {
    display: flex;
    min-height: 100vh;
  }

  .sidebar {
    width: 250px;
    background-color: #212529; 
    color: white;
    padding: 1.5rem;
  }

  .main-content {
    flex-grow: 1;
    padding: 2rem;
  }
  .sidebarStyle{
    background: white;
    appearance: auto;
    -webkit-appearance: menulist;
    -moz-appearance: menulist;
  }
  .sidebarStyle a{
    color: black;
    border-radius: 10px;
    transition: background 0.1s ease;
  }

  .sidebarStyle a:hover{
    color: black;
    background: rgb(187, 187, 187);
    border-radius: 10px;
  }

  .sidebarStyle a:focus{
    color: black;
    background: rgb(131, 131, 131);
    border-radius: 10px;
  }
</style>

<!-- SideBar -->
<div class="layout">

  <!-- Main content -->
  <div class="main-content text-dark">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">Product Catalog</h4>
    </div>

        <form method="GET" action="" class="row g-2 mb-4">
          <div class="col-md-6">
            <input 
              type="text" 
              name="q" 
              class="form-control" 
              placeholder="Search products..." 
              value="{{ query|default:'' }}"
            >
          </div>
          <div class="col-md-4">
            <select name="category" class="form-select">
              <option value="all" {% if selected_category == 'all' or not selected_category %}selected{% endif %}>All Categories</option>
              {% for value, label in categories %}
                <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-2">
            <a href="{% url 'add_product' %}" class="btn btn-success btn w-100">
              + Add Product
            </a>
          </div>
        </form>

        <div class="d-flex justify-content-start align-items-center gap-3 mb-3">
            <a href="?status=active" class="fw-bold text-decoration-none {% if status_filter == 'active' %}text-primary border-bottom border-2 border-primary{% else %}text-secondary{% endif %}">
                Active
            </a>
            <a href="?status=archive" class="fw-bold text-decoration-none {% if status_filter == 'archive' %}text-primary border-bottom border-2 border-primary{% else %}text-secondary{% endif %}">
                Archive
            </a>
        </div>

        <div class="table-responsive">
          <table class="table table-bordered table-striped align-middle">
              <thead class="table-dark">
                  <tr>
                      <th>SKU</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Price (₱)</th>
                      <th>Status</th>
                      <th>Quantity</th>
                      <th>Date Added</th>
                      <th class="text-center">Actions</th>
                  </tr>
              </thead>
              <tbody>
                  {% if products %}
                      {% for product in products %}
                          <tr>
                              <td>{{ product.code }}</td>
                              <td>{{ product.name }}</td>
                              <td>{{ product.get_categories_display }}</td>
                              <td>₱{{ product.price }}</td>
                              <td>{{ product.status|capfirst }}</td>
                              <td>{{ product.quantity }}</td>
                              <td>{{ product.date_added|date:"M d, Y" }}</td>
                              <td class="d-flex flex-column align-items-center gap-2">
                                  <a href="{% url 'edit_product' product.id %}" class="btn btn-sm btn-warning" style="width: 150px;">Edit</a>
                                  <form action="{% url 'delete_product' product.id %}" method="POST" class="d-inline">
                                      {% csrf_token %}
                                      <button type="submit" class="btn btn-sm btn-danger" style="width: 150px;"
                                              onclick="return confirm('Are you sure you want to delete this product?');">
                                          Delete
                                      </button>
                                  </form>
                              </td>
                          </tr>
                      {% endfor %}
                  {% else %}
                      <tr>
                          <td colspan="8" class="text-center text-muted">No products found.</td>
                      </tr>
                  {% endif %}
              </tbody>
          </table>
        </div>

    <footer class="bg-white text-dark text-center border-top mt-5 py-3">
      &copy; 2025 Group8 SariSariStock. All rights reserved.
    </footer>
  </div>
</div>

<script>
  document.querySelector('select[name="category"]').addEventListener('change', function() {
    this.form.submit();
  });

  document.addEventListener("DOMContentLoaded", function() {
    const searchInput = document.querySelector('input[name="q"]');
    const categorySelect = document.querySelector('select[name="category"]');
    const form = searchInput.closest("form");

    // Submit the form when the category is changed
    categorySelect.addEventListener("change", function() {
      form.submit();
    });

    // Delay for typing (so it doesn’t submit on every keystroke)
    let typingTimer;
    const typingDelay = 500; // in milliseconds

    searchInput.addEventListener("keyup", function() {
      clearTimeout(typingTimer);
      typingTimer = setTimeout(() => {
        form.submit();
      }, typingDelay);
    });

    searchInput.addEventListener("keydown", function() {
      clearTimeout(typingTimer);
    });
  });

</script>


{% endblock %}